@page "/register"
@inject HttpClient Http
@inject NavigationManager Navigation
@using System.Net.Http.Json

<div class="container my-4" style="max-width: 400px;">
    <h1>Registrera</h1>
    <div class="mb-3">
        <label for="username" class="form-label">Användarnamn:</label>
        <input id="username" class="form-control" @bind="registerRequest.Username" />
    </div>
    <div class="mb-3">
        <label for="password" class="form-label">Lösenord:</label>
        <input id="password" type="password" class="form-control" @bind="registerRequest.Password" />
    </div>
    <button class="btn btn-primary" @onclick="RegisterUser">Registrera</button>

    @if (!string.IsNullOrEmpty(message))
    {
        <div class="alert alert-info mt-3">@message</div>
    }
</div>

@code {
    private RegisterRequest registerRequest = new();
    private string message = "";

    private async Task RegisterUser()
    {
        var response = await Http.PostAsJsonAsync("auth/register", registerRequest);
        if (response.IsSuccessStatusCode)
        {
            message = "Registrering lyckades! Du omdirigeras till inloggning...";
            await Task.Delay(2000); // Visa meddelande i 2 sekunder
            Navigation.NavigateTo("/login");
        }
        else
        {
            var error = await response.Content.ReadAsStringAsync();
            message = $"Registrering misslyckades: {error}";
        }
    }

    public class RegisterRequest
    {
        public string Username { get; set; } = "";
        public string Password { get; set; } = "";
    }
}
